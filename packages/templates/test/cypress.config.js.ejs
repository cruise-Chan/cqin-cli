import { defineConfig } from 'cypress';

<%_ if (builder === 'Webpack') { _%>
import webpackDevServer from '@cypress/webpack-dev-server'; // ESM 静态导入
<%_ } else { _%>
import { injectDevServer } from '@cypress/vite-dev-server'; // Vite 适配器
<%_ } _%>

export default defineConfig({
  e2e: {
    baseUrl: 'http://localhost:5173',
    defaultCommandTimeout: 10000,
    experimentalMemoryManagement: true,
    numTestsKeptInMemory: 10,
    setupNodeEvents(on, config) {
      <%_ if (builder === 'Webpack') { _%>
      on('dev-server:start', (options) => {
        return webpackDevServer(options); // 直接使用已导入的模块
      });
      <%_ } else { _%>
      injectDevServer(on, config); // 使用 Vite 适配器
      <%_ } _%>
      return config;
    },
    env: {
      apiPrefix: '/api/v1'
    },
  },
});